<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student ERP • Attendance</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --blue:#4da6ff;
      --blue-soft:#e6f2ff;
      --text:#555555;
      --border:#dddddd;
      --green:#28a745;
      --orange:#ff9800;
      --red:#e53935;
    }
    body{ font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; color: var(--text); }
    .font-heading{ font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', sans-serif; }
    .card{
      border-radius:20px;
      box-shadow: 0 10px 24px rgba(0,0,0,0.06);
      background:white;
      border: 1px solid var(--border);
    }
    .nav-shadow{
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
    }
    .soft-gradient{
      background: linear-gradient(135deg, var(--blue-soft), #f7fbff);
    }
    .btn-primary{
      background: linear-gradient(135deg, #4da6ff, #3c8ce7);
      color:white;
    }
    .btn-primary:hover{ filter: brightness(0.98); }
    .badge{
      padding: .25rem .6rem;
      border-radius: 999px;
      font-size: .75rem;
      font-weight: 600;
      color:white;
      display: inline-flex;
      align-items: center;
      gap:.4rem;
    }
    .badge-green{ background: var(--green); }
    .badge-orange{ background: var(--orange); }
    .badge-red{ background: var(--red); }
    .table thead th{
      position: sticky; top: 0; background: white; z-index: 1;
      border-bottom: 1px solid var(--border);
    }
    .table tbody tr:nth-child(even){ background: #f8f8f8; } /* striped rows */
    .tooltip{
      position: absolute;
      left: 0; top: 120%;
      min-width: 220px;
      background: #0f172a;
      color: #e5e7eb;
      border-radius: 12px;
      padding: .6rem .75rem;
      font-size: .825rem;
      box-shadow: 0 10px 24px rgba(0,0,0,.18);
      border: 1px solid rgba(255,255,255,.06);
      opacity: 0; pointer-events: none; transform: translateY(-4px);
      transition: opacity .18s ease, transform .18s ease;
      white-space: normal;
    }
    .tooltip[data-show="true"]{ opacity: 1; pointer-events: auto; transform: translateY(0); }
    .info-dot{
      width: 18px; height: 18px; border-radius: 999px; display: inline-flex; align-items: center; justify-content: center;
      background: var(--blue-soft); color: var(--blue); border: 1px solid var(--blue);
      cursor: pointer;
    }
    /* Circular progress animation */
    .progress-ring__circle{
      transition: stroke-dashoffset 900ms ease;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
    }

    /* Indicator bar (0-100) with safe zone >=75% */
    .indicator-track{
      height: 12px; border-radius: 999px; overflow: hidden; position: relative; border:1px solid var(--border);
      background:
        linear-gradient(90deg,
          #f3c1bb 0%,
          #f3c1bb 50%,
          #ffd9a8 50%,
          #ffd9a8 75%,
          #bde7c8 75%,
          #bde7c8 100%);
    }
    .heading{
        font-size: 25px !important;
    }
    .indicator-thumb{
      position: absolute; top: 50%; transform: translate(-50%,-50%);
      width: 18px; height: 18px; border-radius: 999px; background: var(--blue);
      border: 2px solid white; box-shadow: 0 2px 6px rgba(0,0,0,.25);
    }
    .indicator-threshold{
      position:absolute; left: 75%; top: 0; bottom: 0;
      width: 2px; background: rgba(0,0,0,.15);
    }
    .indicator-label{
      font-size: .75rem; color: #64748b;
    }

    /* Dropdown */
    .dropdown{ position: absolute; right:0; top: 120%; min-width: 260px; background:white; border:1px solid var(--border);
      border-radius:14px; box-shadow: 0 14px 32px rgba(0,0,0,.12); opacity:0; transform: translateY(-6px); pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
    }
    .dropdown[data-open="true"]{ opacity:1; transform: translateY(0); pointer-events:auto; }

    /* Print styles */
    @media print{
      body{ color:#000; }
      .no-print{ display:none !important; }
      .card{ box-shadow:none; border:1px solid #aaa; }
      .btn-primary{ display:none !important; }
      .dropdown{ display:none !important; }
      .indicator-label{ color:#000 !important; }
      .badge{ color:#fff !important; }
      .table thead th{ position: static; }
    }
  </style>
</head>
<body class="bg-white">
  <!-- Top Navigation -->
  <!-- Top Navigation -->
  <header class="fixed top-0 inset-x-0 z-50 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-b border-slate-100 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 md:px-6">
      <div class="h-16 flex items-center justify-between">
        <!-- Left: Logo -->
        <a href="#" class="flex items-center gap-3 group" onclick="event.preventDefault()">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-[#e6f2ff] to-[#4da6ff]/20 ring-1 ring-[#4da6ff]/20">
            <!-- Simple logo -->
            <svg width="20" height="20" viewBox="0 0 24 24" class="text-[#4da6ff]">
              <path d="M3 11l9-7v16l-9-7zM14 7h7v10h-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <div class="leading-tight">
            <div class="font-poppins font-semibold text-slate-900">Student ERP</div>
            <div class="text-xs text-slate-500 -mt-0.5">Campus Portal</div>
          </div>
        </a>

        <!-- Middle: Page Title -->
        <h1 class="hidden sm:block font-poppins font-semibold text-slate-900 tracking-tight heading">
          Attendance
        </h1>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2">
          <!-- Notifications -->
          <div class="relative">
            <button id="btnBell" class="relative inline-flex items-center justify-center h-10 w-10 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors"
              aria-label="Notifications" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 0 0-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5m6 0a3 3 0 0 1-6 0" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="bellDot" class="hidden absolute -top-1 -right-1 h-2.5 w-2.5 bg-[#4da6ff] rounded-full ring-2 ring-white"></span>
            </button>
            <!-- Bell popover -->
            <div id="bellMenu" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 p-3">
              <div class="flex items-center justify-between px-1 pb-2">
                <div class="font-poppins font-semibold text-slate-900">Recent</div>
                <button id="markAllRead" class="text-xs text-[#4da6ff] hover:underline">Mark all read</button>
              </div>
              <div id="bellList" class="space-y-2 max-h-64 overflow-auto nice-scroll pr-1"></div>
              <div class="pt-2 text-center">
                <a href="#latest" class="text-xs text-slate-500 hover:text-slate-700" onclick="closeAllMenus()">View all announcements</a>
              </div>
            </div>
          </div>

          <!-- Profile -->
          <div class="relative">
            <button id="btnProfile" class="inline-flex items-center justify-center h-10 px-3 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors gap-2" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 3c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z" fill="currentColor"/>
              </svg>
              <span class="hidden sm:inline text-sm text-slate-800">Profile</span>
            </button>
            <!-- Profile dropdown -->
            <div id="profileMenu" class="hidden absolute right-0 mt-2 w-52 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 overflow-hidden">
              <div class="px-4 py-3">
                <div class="font-poppins font-semibold text-slate-900">John Doe</div>
                <div class="text-xs text-slate-500">Student • CS Dept</div>
              </div>
              <div class="border-t border-slate-100"></div>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">View Profile</button>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 lg:px-6 pt-24 pb-16 space-y-8">
    <!-- Overall Summary Card -->
    <section class="card p-6 md:p-8">
      <div class="flex flex-col md:flex-row items-center md:items-stretch gap-8">
        <!-- Progress Circle -->
        <div class="flex items-center justify-center">
          <svg id="progressSvg" width="220" height="220" viewBox="0 0 220 220">
            <defs>
              <linearGradient id="progressGradient" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#4da6ff"/>
                <stop offset="100%" stop-color="#3c8ce7"/>
              </linearGradient>
            </defs>
            <circle cx="110" cy="110" r="90" stroke="#e6f2ff" stroke-width="20" fill="none"></circle>
            <circle id="progressCircle" class="progress-ring__circle" cx="110" cy="110" r="90" stroke="url(#progressGradient)" stroke-width="20" stroke-linecap="round" fill="none" stroke-dasharray="0 999"></circle>
            <g>
              <text id="overallText" x="110" y="110" text-anchor="middle" dominant-baseline="central" class="font-heading" font-size="36" fill="#111827">0%</text>
              <text x="110" y="138" text-anchor="middle" font-size="12" fill="#64748b">Overall Attendance</text>
            </g>
          </svg>
        </div>

        <!-- Right: Indicator + Info -->
        <div class="flex-1 flex flex-col justify-center gap-5 w-full">
          <div class="space-y-2">
            <div class="font-heading text-lg font-semibold">Status overview</div>
            <p class="text-sm text-slate-600">Keep your attendance at or above the safe threshold to stay eligible for exams.</p>
          </div>
          <div>
            <div class="indicator-track relative w-full">
              <div class="indicator-threshold" aria-hidden="true"></div>
              <div id="indicatorThumb" class="indicator-thumb" style="left: 0%;"></div>
            </div>
            <div class="flex items-center justify-between mt-2 indicator-label">
              <span>0%</span>
              <span class="flex items-center gap-2">
                <span class="inline-flex items-center gap-1"><span class="w-3 h-3 rounded-full" style="background:#bde7c8;"></span> Safe ≥75%</span>
              </span>
              <span>100%</span>
            </div>
          </div>

          <!-- Legend -->
          <div class="grid grid-cols-3 gap-2 pt-2">
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full" style="background:var(--green)"></span><span class="text-sm">Good (≥85%)</span></div>
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full" style="background:var(--orange)"></span><span class="text-sm">Medium (75–84%)</span></div>
            <div class="flex items-center gap-2"><span class="w-3 h-3 rounded-full" style="background:var(--red)"></span><span class="text-sm">Low (&lt;75%)</span></div>
          </div>
        </div>
      </div>
    </section>

    <!-- Subject-wise Attendance -->
    <section class="card p-6 md:p-8">
      <div class="flex items-center justify-between gap-4 mb-4">
        <h2 class="font-heading text-xl font-bold">Subject-wise Attendance</h2>
        <div class="flex items-center gap-2">
          <!-- Export icons -->
          <button id="exportPdf" class="no-print w-10 h-10 rounded-full border border-[color:var(--border)] bg-white hover:bg-[color:var(--blue-soft)] flex items-center justify-center" title="Export as PDF">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="text-[color:var(--text)]">
              <path d="M6 2h9l5 5v13a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zM14 3v5h5"/>
              <path d="M8 13h2a2 2 0 0 1 0 4H8v-4zm2 0v4M13 13h1.5a1.5 1.5 0 0 1 0 3H13v-3zm0 0v3M17 13h2M17 16h2"/>
            </svg>
          </button>
          <button id="exportExcel" class="no-print w-10 h-10 rounded-full border border-[color:var(--border)] bg-white hover:bg-[color:var(--blue-soft)] flex items-center justify-center" title="Export as Excel">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" class="text-[color:var(--text)]">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <path fill="#e6f2ff" d="M14 2v6h6z"/>
              <path d="M8.5 15.5 11 13l-2.5-2.5M12.5 15.5 10 13l2.5-2.5" stroke="#e6f2ff" stroke-width="1.2" fill="none"/>
            </svg>
          </button>
          <button id="downloadBtn" class="no-print btn-primary rounded-full px-4 py-2 font-medium shadow-sm focus:outline-none focus:ring-2 focus:ring-[#4da6ff]/40">
            Download Attendance Report
          </button>
        </div>
      </div>

      <!-- Desktop Table -->
      <div class="hidden md:block">
        <div class="border border-[color:var(--border)] rounded-2xl overflow-hidden">
          <div class="max-h-80 overflow-y-auto">
            <table class="table w-full text-sm">
              <thead>
                <tr class="text-left">
                  <th class="py-3 px-4">Subject Code</th>
                  <th class="py-3 px-4">Subject Name</th>
                  <th class="py-3 px-4">Classes Attended</th>
                  <th class="py-3 px-4">Total Classes</th>
                  <th class="py-3 px-4">Percentage</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Mobile Collapsible List -->
      <div class="md:hidden">
        <div id="mobileList" class="space-y-3"></div>
      </div>
    </section>

    <!-- Alerts -->
    <section class="card p-6 md:p-8">
      <div class="flex items-center justify-between mb-4">
        <h2 class="font-heading text-xl font-bold">Alerts</h2>
      </div>
      <div id="alertsList" class="space-y-3">
        <!-- Alerts will render here -->
      </div>
    </section>
  </main>

  <script>
    // Sample data
    const subjects = [
      { id: 'MTH101', code: 'MTH101', name: 'Calculus I', attended: 28, total: 34, faculty: 'Dr. Meera Shah', schedule: 'Mon & Wed, 10:00–11:00 AM' },
      { id: 'PHY102', code: 'PHY102', name: 'Physics I', attended: 22, total: 32, faculty: 'Prof. R. Iyer', schedule: 'Tue & Thu, 9:00–10:00 AM' },
      { id: 'CHE103', code: 'CHE103', name: 'Chemistry', attended: 25, total: 35, faculty: 'Dr. Anita Rao', schedule: 'Fri, 11:00 AM–1:00 PM' },
      { id: 'CSE104', code: 'CSE104', name: 'Programming', attended: 30, total: 33, faculty: 'Mr. K. Verma', schedule: 'Mon & Wed, 1:00–2:00 PM' },
      { id: 'HUM105', code: 'HUM105', name: 'Communication', attended: 18, total: 26, faculty: 'Ms. P. Nair', schedule: 'Tue, 2:00–4:00 PM' },
      { id: 'LAB106', code: 'LAB106', name: 'Physics Lab', attended: 10, total: 15, faculty: 'Lab Team', schedule: 'Thu, 2:00–5:00 PM' },
    ];

    // Utility functions
    const pct = (a,t)=> t===0?0:Math.round((a/t)*100);
    const badgeInfo = (p)=> {
      if(p >= 85) return { cls:'badge-green', label:'Good', color: getComputedStyle(document.documentElement).getPropertyValue('--green').trim() };
      if(p >= 75) return { cls:'badge-orange', label:'Medium', color: getComputedStyle(document.documentElement).getPropertyValue('--orange').trim() };
      return { cls:'badge-red', label:'Low', color: getComputedStyle(document.documentElement).getPropertyValue('--red').trim() };
    };

    function calcOverall(){
      const totalAtt = subjects.reduce((s,x)=>s+x.attended,0);
      const totalCls = subjects.reduce((s,x)=>s+x.total,0);
      return { percent: pct(totalAtt, totalCls), attended: totalAtt, total: totalCls };
    }

    function renderOverall(){
      const { percent } = calcOverall();
      // Progress ring
      const circle = document.getElementById('progressCircle');
      const text = document.getElementById('overallText');
      const radius = 90;
      const circumference = 2 * Math.PI * radius;
      circle.setAttribute('stroke-dasharray', `${circumference} ${circumference}`);
      const offset = circumference - (percent / 100) * circumference;
      // Animate with small timeout for initial paint
      requestAnimationFrame(()=>{
        circle.style.strokeDashoffset = offset;
        text.textContent = percent + '%';
      });
      // Indicator bar thumb position
      const thumb = document.getElementById('indicatorThumb');
      thumb.style.left = Math.min(100, Math.max(0, percent)) + '%';
    }

    // Desktop table
    function renderTable(){
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      for(const s of subjects){
        const p = pct(s.attended, s.total);
        const { cls, label } = badgeInfo(p);
        const tr = document.createElement('tr');
        tr.className = 'group';
        tr.innerHTML = `
          <td class="py-3 px-4 align-top">${s.code}</td>
          <td class="py-3 px-4 align-top">
            <div class="flex items-start gap-2">
              <div class="min-w-0">
                <div class="font-medium">${s.name}</div>
                <div class="text-xs text-slate-500">${s.faculty}</div>
              </div>
              <div class="relative">
                <button class="info-dot" aria-label="More info" data-tooltip>
                  i
                </button>
                <div class="tooltip">
                  <div class="font-heading text-[13px] font-semibold mb-1">${s.name}</div>
                  <div class="text-[12px]"><span class="opacity-80">Faculty:</span> ${s.faculty}</div>
                  <div class="text-[12px]"><span class="opacity-80">Schedule:</span> ${s.schedule}</div>
                </div>
              </div>
            </div>
          </td>
          <td class="py-3 px-4 align-top">${s.attended}</td>
          <td class="py-3 px-4 align-top">${s.total}</td>
          <td class="py-3 px-4 align-top">
            <span class="badge ${cls}">
              <span>${p}%</span>
              <span class="hidden sm:inline">• ${label}</span>
            </span>
          </td>
        `;
        tbody.appendChild(tr);
      }
      bindTooltips();
    }

    // Mobile list
    function renderMobileList(){
      const wrap = document.getElementById('mobileList');
      wrap.innerHTML = '';
      for(const s of subjects){
        const p = pct(s.attended, s.total);
        const { cls, label } = badgeInfo(p);
        const item = document.createElement('div');
        item.className = 'border border-[color:var(--border)] rounded-2xl p-4';
        item.innerHTML = `
          <button class="w-full flex items-center justify-between gap-3" data-acc-btn aria-expanded="false">
            <div class="text-left">
              <div class="font-heading font-semibold">${s.name}</div>
              <div class="text-xs text-slate-500">${s.code}</div>
            </div>
            <div class="flex items-center gap-3">
              <span class="badge ${cls}">${p}% <span class="hidden xs:inline">• ${label}</span></span>
              <svg class="text-slate-500 transition-transform" data-acc-icon width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path stroke-width="2" d="M6 9l6 6 6-6"/>
              </svg>
            </div>
          </button>
          <div class="grid grid-cols-2 gap-3 mt-3 overflow-hidden" data-acc-panel style="max-height:0; opacity:0;">
            <div class="p-3 rounded-xl bg-[color:var(--blue-soft)]/60">
              <div class="text-xs text-slate-500">Attended</div>
              <div class="font-semibold">${s.attended}</div>
            </div>
            <div class="p-3 rounded-xl bg-[color:var(--blue-soft)]/60">
              <div class="text-xs text-slate-500">Total</div>
              <div class="font-semibold">${s.total}</div>
            </div>
            <div class="col-span-2 p-3 rounded-xl border border-[color:var(--border)]">
              <div class="text-xs text-slate-500">Faculty</div>
              <div class="font-medium">${s.faculty}</div>
            </div>
            <div class="col-span-2 p-3 rounded-xl border border-[color:var(--border)]">
              <div class="text-xs text-slate-500">Schedule</div>
              <div class="font-medium">${s.schedule}</div>
            </div>
          </div>
        `;
        wrap.appendChild(item);
      }
      bindMobileAccordions();
    }

    // Alerts
    function renderAlerts(){
      const container = document.getElementById('alertsList');
      container.innerHTML = '';
      const low = subjects.map(s=>({ ...s, percent:pct(s.attended,s.total) })).filter(x=>x.percent < 75);
      if(low.length === 0){
        container.innerHTML = '<div class="p-4 rounded-xl bg-[color:var(--blue-soft)] border border-[color:var(--border)]">All good! No low attendance alerts right now.</div>';
        return;
      }
      for(const s of low){
        const row = document.createElement('div');
        row.className = 'flex items-start gap-3 p-4 rounded-xl border border-[color:var(--border)] bg-red-50';
        row.innerHTML = `
          <div class="mt-0.5">
            <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--red)">
              <path stroke-width="2" d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
              <line x1="12" y1="9" x2="12" y2="13" stroke-width="2"/>
              <line x1="12" y1="17" x2="12.01" y2="17" stroke-width="2"/>
            </svg>
          </div>
          <div class="flex-1">
            <div class="flex items-center justify-between">
              <div class="font-heading font-semibold">${s.name}</div>
              <span class="badge badge-red">${s.percent}%</span>
            </div>
            <div class="text-sm mt-1">Attend next 3 classes to recover</div>
            <div class="text-xs text-slate-500 mt-1">${s.code} • ${s.faculty} • ${s.schedule}</div>
          </div>
        `;
        container.appendChild(row);
      }
    }

    // Tooltips behavior (desktop table)
    function bindTooltips(){
      const buttons = document.querySelectorAll('[data-tooltip]');
      buttons.forEach(btn=>{
        const tip = btn.parentElement.querySelector('.tooltip');
        let hideTimeout;
        const show = ()=>{ clearTimeout(hideTimeout); tip.setAttribute('data-show','true'); };
        const hide = ()=>{ hideTimeout = setTimeout(()=> tip.setAttribute('data-show','false'), 120); };

        btn.addEventListener('mouseenter', show);
        btn.addEventListener('mouseleave', hide);
        tip.addEventListener('mouseenter', show);
        tip.addEventListener('mouseleave', hide);

        // On click (for touch)
        btn.addEventListener('click', (e)=>{
          e.stopPropagation();
          const isShown = tip.getAttribute('data-show') === 'true';
          document.querySelectorAll('.tooltip[data-show="true"]').forEach(t=>t.setAttribute('data-show','false'));
          tip.setAttribute('data-show', isShown ? 'false' : 'true');
        });
        document.addEventListener('click', ()=> tip.setAttribute('data-show','false'));
      });
    }

    // Mobile accordion behavior
    function bindMobileAccordions(){
      document.querySelectorAll('[data-acc-btn]').forEach(btn=>{
        const panel = btn.parentElement.querySelector('[data-acc-panel]');
        const icon = btn.querySelector('[data-acc-icon]');
        btn.addEventListener('click', ()=>{
          const open = btn.getAttribute('aria-expanded') === 'true';
          btn.setAttribute('aria-expanded', !open);
          if(!open){
            panel.style.maxHeight = panel.scrollHeight + 'px';
            panel.style.opacity = 1;
            icon.style.transform = 'rotate(180deg)';
          }else{
            panel.style.maxHeight = '0px';
            panel.style.opacity = 0;
            icon.style.transform = 'rotate(0deg)';
          }
        });
      });
    }

    // Export: CSV (works for Excel) and Print (for PDF)
    function buildCSV(){
      const { percent, attended, total } = calcOverall();
      const lines = [];
      lines.push('Student Attendance Report');
      lines.push(`Overall,${percent}% (${attended}/${total})`);
      lines.push('');
      lines.push('Subject Code,Subject Name,Classes Attended,Total Classes,Percentage,Faculty,Schedule');
      for(const s of subjects){
        const p = pct(s.attended, s.total);
        // escape commas by wrapping in quotes
        const row = [
          s.code,
          `"${s.name}"`,
          s.attended,
          s.total,
          p + '%',
          `"${s.faculty}"`,
          `"${s.schedule}"`
        ].join(',');
        lines.push(row);
      }
      return lines.join('\n');
    }

    function downloadCSV(filename='Student_Attendance_Report.csv'){
      const csv = buildCSV();
      const blob = new Blob([csv], {type: 'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function printReport(){
      window.print();
    }

    // Nav dropdowns
    function bindNav(){
      const notifyBtn = document.getElementById('notifyBtn');
      const notifyMenu = document.getElementById('notifyMenu');
      const profileBtn = document.getElementById('profileBtn');
      const profileMenu = document.getElementById('profileMenu');

      const closeAll = ()=>{
        notifyMenu.setAttribute('data-open','false');
        profileMenu.setAttribute('data-open','false');
      };

      notifyBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const open = notifyMenu.getAttribute('data-open')==='true';
        closeAll();
        notifyMenu.setAttribute('data-open', open ? 'false' : 'true');
      });
      profileBtn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const open = profileMenu.getAttribute('data-open')==='true';
        closeAll();
        profileMenu.setAttribute('data-open', open ? 'false' : 'true');
      });
      document.addEventListener('click', closeAll);
    }

    // Bind actions
    function bindActions(){
      document.getElementById('downloadBtn').addEventListener('click', (e)=>{ e.preventDefault(); downloadCSV(); });
      document.getElementById('exportExcel').addEventListener('click', (e)=>{ e.preventDefault(); downloadCSV('Student_Attendance.csv'); });
      document.getElementById('exportPdf').addEventListener('click', (e)=>{ e.preventDefault(); printReport(); });
    }

    // Init
    (function init(){
      renderOverall();
      renderTable();
      renderMobileList();
      renderAlerts();
      bindNav();
      bindActions();
    })();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'982241ad97f32dfd',t:'MTc1ODM4MTA5OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
