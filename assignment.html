<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Student ERP — Assignments & Projects</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            heading: ['Poppins', 'ui-sans-serif', 'system-ui'],
            sans: ['Roboto', 'ui-sans-serif', 'system-ui'],
          },
          boxShadow: {
            soft: '0 10px 30px rgba(0,0,0,0.06)',
          }
        }
      }
    }
  </script>

  <style>
    :root{
      --primary:#4da6ff;
      --primary-soft:#e6f2ff;
      --text-secondary:#555555;
      --success:#28a745;
      --warning:#ff9800;
      --danger:#e53935;
      --card-radius:20px;
    }

    /* Blue gradient action buttons */
    .btn-gradient{
      background-image: linear-gradient(135deg, #4da6ff 0%, #1e78ff 100%);
      color:#fff;
      transition: transform .15s ease, box-shadow .15s ease, opacity .15s ease;
    }
    .btn-gradient:hover{
      transform: translateY(-1px);
      box-shadow: 0 8px 18px rgba(77,166,255,.35);
      opacity: .95;
    }
    .btn-gradient:active{
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(77,166,255,.25);
    }

    /* Status badges */
    .badge{ padding: .25rem .6rem; border-radius: 9999px; font-weight: 600; font-size:.75rem; letter-spacing:.01em; }
    .badge-success{ background: rgba(40,167,69,.12); color: var(--success); }
    .badge-warning{ background: rgba(255,152,0,.16); color: var(--warning); }
    .badge-danger{ background: rgba(229,57,53,.12); color: var(--danger); }

    /* Overdue row tint */
    .row-overdue{ background: rgba(229,57,53,.06); }

    /* Light blue highlight for next deadline */
    .highlight-next{ background: var(--primary-soft); border-left: 4px solid var(--primary); }

    /* Progress bar gradient */
    .progress-track{ background: #f1f5f9; } /* slate-100-ish */
    .progress-fill{
      background-image: linear-gradient(90deg, #e6f2ff 0%, #4da6ff 100%);
      transition: width .6s ease;
    }
    .heading{
        font-size: 25px !important;
    }

    /* Cards hover lift */
    .lift{
      transition: transform .2s ease, box-shadow .2s ease;
    }
    .lift:hover{
      transform: translateY(-4px);
      box-shadow: 0 16px 32px rgba(0,0,0,.08);
    }

    /* Pretty scroll */
    .nice-scroll{
      scrollbar-width: thin;
      scrollbar-color: #c7dbff transparent;
    }
    .nice-scroll::-webkit-scrollbar{ height:8px; width:8px; }
    .nice-scroll::-webkit-scrollbar-thumb{ background:#c7dbff; border-radius:8px; }
    .nice-scroll::-webkit-scrollbar-track{ background:transparent; }

    /* Utility */
    .rounded-20{ border-radius: var(--card-radius); }
  </style>
</head>
<body class="bg-white text-gray-800 font-sans">

  <!-- Top Navigation (fixed) -->
  <header class="fixed top-0 inset-x-0 z-50 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-b border-slate-100 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 md:px-6">
      <div class="h-16 flex items-center justify-between">
        <!-- Left: Logo -->
        <a href="#" class="flex items-center gap-3 group" onclick="event.preventDefault()">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-[#e6f2ff] to-[#4da6ff]/20 ring-1 ring-[#4da6ff]/20">
            <!-- Simple logo -->
            <svg width="20" height="20" viewBox="0 0 24 24" class="text-[#4da6ff]">
              <path d="M3 11l9-7v16l-9-7zM14 7h7v10h-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <div class="leading-tight">
            <div class="font-poppins font-semibold text-slate-900">Student ERP</div>
            <div class="text-xs text-slate-500 -mt-0.5">Campus Portal</div>
          </div>
        </a>

        <!-- Middle: Page Title -->
        <h1 class="hidden sm:block font-poppins font-semibold text-slate-900 tracking-tight heading">
          Assignments & Projects
        </h1>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2">
          <!-- Notifications -->
          <div class="relative">
            <button id="btnBell" class="relative inline-flex items-center justify-center h-10 w-10 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors"
              aria-label="Notifications" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 0 0-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5m6 0a3 3 0 0 1-6 0" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="bellDot" class="hidden absolute -top-1 -right-1 h-2.5 w-2.5 bg-[#4da6ff] rounded-full ring-2 ring-white"></span>
            </button>
            <!-- Bell popover -->
            <div id="bellMenu" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 p-3">
              <div class="flex items-center justify-between px-1 pb-2">
                <div class="font-poppins font-semibold text-slate-900">Recent</div>
                <button id="markAllRead" class="text-xs text-[#4da6ff] hover:underline">Mark all read</button>
              </div>
              <div id="bellList" class="space-y-2 max-h-64 overflow-auto nice-scroll pr-1"></div>
              <div class="pt-2 text-center">
                <a href="#latest" class="text-xs text-slate-500 hover:text-slate-700" onclick="closeAllMenus()">View all announcements</a>
              </div>
            </div>
          </div>

          <!-- Profile -->
          <div class="relative">
            <button id="btnProfile" class="inline-flex items-center justify-center h-10 px-3 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors gap-2" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 3c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z" fill="currentColor"/>
              </svg>
              <span class="hidden sm:inline text-sm text-slate-800">Profile</span>
            </button>
            <!-- Profile dropdown -->
            <div id="profileMenu" class="hidden absolute right-0 mt-2 w-52 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 overflow-hidden">
              <div class="px-4 py-3">
                <div class="font-poppins font-semibold text-slate-900">John Doe</div>
                <div class="text-xs text-slate-500">Student • CS Dept</div>
              </div>
              <div class="border-t border-slate-100"></div>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">View Profile</button>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-7xl mx-auto px-4 md:px-6 pt-24 pb-10">
    <div class="grid grid-cols-12 gap-6 items-start">

      <!-- Assignments (Left 60%) -->
      <section class="col-span-12 lg:col-span-7">
        <div class="rounded-20 shadow-soft border border-gray-100 bg-white">
          <div class="flex flex-col md:flex-row md:items-center justify-between gap-3 px-5 md:px-6 py-4 border-b">
            <h2 class="font-heading font-semibold text-lg">My Assignments</h2>
            <div class="relative w-full md:w-80">
              <input id="assignmentSearch" type="text" placeholder="Search by subject or title..."
                class="w-full rounded-xl border border-gray-200 focus:border-[var(--primary)] focus:ring-2 focus:ring-[var(--primary)]/20 px-4 py-2.5 text-sm outline-none" />
              <div class="absolute right-3 top-2.5 text-gray-400">🔎</div>
            </div>
          </div>

          <!-- Table (desktop) -->
          <div class="hidden md:block px-2 pb-2">
            <div class="overflow-x-auto">
              <table class="min-w-full table-auto">
                <thead class="text-left text-gray-500 text-sm">
                  <tr>
                    <th class="px-4 py-3">Subject</th>
                    <th class="px-4 py-3">Assignment Title</th>
                    <th class="px-4 py-3">Due Date</th>
                    <th class="px-4 py-3">Status</th>
                    <th class="px-4 py-3 text-right">Action</th>
                  </tr>
                </thead>
                <tbody id="assignmentsTable" class="align-middle text-sm">
                  <!-- rows injected -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Cards (mobile) -->
          <div id="assignmentsCards" class="md:hidden px-4 py-4 space-y-3">
            <!-- cards injected -->
          </div>

          <!-- Scroll hint -->
          <div class="px-5 pb-5 text-xs text-gray-500">
            Tip: Scroll the list if it grows long.
          </div>
        </div>
      </section>

      <!-- Projects (Right 40%) -->
      <aside class="col-span-12 lg:col-span-5">
        <div class="rounded-20 shadow-soft border border-gray-100 bg-white">
          <div class="flex items-center justify-between px-5 md:px-6 py-4 border-b">
            <h2 class="font-heading font-semibold text-lg">Projects</h2>
            <span id="projectsCount" class="text-sm text-gray-500"></span>
          </div>

          <div id="projectsList" class="p-4 md:p-5 space-y-4">
            <!-- project cards injected -->
          </div>
        </div>
      </aside>

      <!-- Upcoming Deadlines -->
      <section class="col-span-12">
        <div class="rounded-20 shadow-soft border border-gray-100 bg-white">
          <div class="px-5 md:px-6 py-4 border-b flex items-center justify-between">
            <h3 class="font-heading font-semibold text-lg">Upcoming Deadlines</h3>
            <button id="refreshTimeline" class="text-sm text-[var(--primary)] hover:underline">Refresh</button>
          </div>
          <div id="timeline" class="p-5 md:p-6">
            <!-- timeline injected -->
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Assignment Upload Modal -->
  <div id="assignmentModal" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-lg bg-white rounded-20 shadow-soft border border-gray-100">
        <div class="px-6 py-4 border-b flex items-center justify-between">
          <h4 class="font-heading text-lg">Upload Submission</h4>
          <button class="text-gray-500 hover:text-gray-700" data-close-assignment-modal>✖</button>
        </div>
        <div class="p-6 space-y-4">
          <div>
            <p class="text-sm text-gray-500">Assignment</p>
            <p id="modalAssignmentTitle" class="font-medium"></p>
          </div>
          <div class="space-y-2">
            <label class="text-sm font-medium">Select file</label>
            <label for="assignmentFileInput" class="block border-2 border-dashed border-gray-200 rounded-xl p-5 text-center hover:border-[var(--primary)] cursor-pointer">
              <div class="text-3xl mb-2">📄</div>
              <p class="text-sm text-gray-600">Drag & drop or click to browse</p>
              <input id="assignmentFileInput" type="file" class="hidden" />
            </label>
            <p id="assignmentFileName" class="text-sm text-[var(--text-secondary)]"></p>
          </div>
          <div class="flex items-center justify-end gap-3 pt-2">
            <button class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50" data-close-assignment-modal>Cancel</button>
            <button id="confirmAssignmentUpload" class="btn-gradient px-4 py-2 rounded-xl disabled:opacity-50" disabled>Upload</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- View Submission Modal -->
  <div id="viewModal" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-md bg-white rounded-20 shadow-soft border border-gray-100">
        <div class="px-6 py-4 border-b flex items-center justify-between">
          <h4 class="font-heading text-lg">Submission</h4>
          <button class="text-gray-500 hover:text-gray-700" data-close-view-modal>✖</button>
        </div>
        <div class="p-6 space-y-4">
          <div>
            <p class="text-sm text-gray-500">Item</p>
            <p id="viewItemTitle" class="font-medium"></p>
          </div>
          <div class="rounded-xl bg-gray-50 border border-gray-200 p-4">
            <p class="text-sm text-gray-600">File:</p>
            <p id="viewFileName" class="font-medium break-words"></p>
            <p id="viewTimestamp" class="text-xs text-gray-500 mt-1"></p>
          </div>
          <div class="flex items-center justify-between pt-2">
            <button id="replaceUpload" class="text-[var(--primary)] hover:underline">Replace file</button>
            <button id="removeUpload" class="text-red-600 hover:underline">Remove</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Project Upload Modal -->
  <div id="projectModal" class="fixed inset-0 z-[60] hidden">
    <div class="absolute inset-0 bg-black/30"></div>
    <div class="absolute inset-0 flex items-center justify-center p-4">
      <div class="w-full max-w-lg bg-white rounded-20 shadow-soft border border-gray-100">
        <div class="px-6 py-4 border-b flex items-center justify-between">
          <h4 class="font-heading text-lg">Upload Project Report</h4>
          <button class="text-gray-500 hover:text-gray-700" data-close-project-modal>✖</button>
        </div>
        <div class="p-6 space-y-4">
          <div>
            <p class="text-sm text-gray-500">Project</p>
            <p id="modalProjectTitle" class="font-medium"></p>
          </div>
          <div class="space-y-2">
            <label class="text-sm font-medium">Select file</label>
            <label for="projectFileInput" class="block border-2 border-dashed border-gray-200 rounded-xl p-5 text-center hover:border-[var(--primary)] cursor-pointer">
              <div class="text-3xl mb-2">📦</div>
              <p class="text-sm text-gray-600">Drag & drop or click to browse</p>
              <input id="projectFileInput" type="file" class="hidden" />
            </label>
            <p id="projectFileName" class="text-sm text-[var(--text-secondary)]"></p>
          </div>
          <div class="flex items-center justify-end gap-3 pt-2">
            <button class="px-4 py-2 rounded-xl border border-gray-200 hover:bg-gray-50" data-close-project-modal>Cancel</button>
            <button id="confirmProjectUpload" class="btn-gradient px-4 py-2 rounded-xl disabled:opacity-50" disabled>Upload</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // --- Utilities ---
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));

    const fmt = (d) => {
      const date = (d instanceof Date) ? d : new Date(d);
      return date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric' });
    };
    const daysUntil = (d) => {
      const date = (d instanceof Date) ? d : new Date(d);
      const start = new Date(); start.setHours(0,0,0,0);
      const end = new Date(date); end.setHours(0,0,0,0);
      return Math.round((end - start) / (1000*60*60*24));
    };
    const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

    // --- Demo Data (relative to today) ---
    const makeAssignments = () => {
      const today = new Date();
      const plus = (n) => { const d = new Date(); d.setDate(today.getDate()+n); return d; };
      return [
        { id:'a1', subject:'Mathematics', title:'Linear Algebra Worksheet', due: plus(2), submitted:false },
        { id:'a2', subject:'Computer Science', title:'Data Structures Quiz Prep', due: plus(-1), submitted:false }, // overdue
        { id:'a3', subject:'Physics', title:'Kinematics Lab Report', due: plus(5), submitted:false },
        { id:'a4', subject:'English', title:'Essay: Modern Literature', due: plus(1), submitted:true, file:{name:'literature-essay.docx', at: new Date()} },
        { id:'a5', subject:'Chemistry', title:'Organic Reactions Sheet', due: plus(3), submitted:false },
        { id:'a6', subject:'Economics', title:'Microeconomics Case Study', due: plus(7), submitted:false },
      ];
    };

    const makeProjects = () => {
      const today = new Date();
      const plus = (n) => { const d = new Date(); d.setDate(today.getDate()+n); return d; };
      return [
        {
          id:'p1',
          title:'Smart Irrigation System',
          desc:'Build a sensor-based irrigation solution optimizing water usage in urban gardens.',
          mentor:{ name:'Dr. Priya Kapoor', email:'priya.kapoor@university.edu' },
          deadline: plus(10),
          team:['Anita Sharma','Rahul Verma','Kunal Shah'],
          progress: 35,
          report:null
        },
        {
          id:'p2',
          title:'Campus Navigation App',
          desc:'Prototype a mobile app for indoor navigation across campus labs and departments.',
          mentor:{ name:'Prof. David Liu', email:'david.liu@university.edu' },
          deadline: plus(4),
          team:['Sara Khan','Leo Martins'],
          progress: 55,
          report:{ name:'nav-app-sprint1.pdf', at: new Date() }
        },
        {
          id:'p3',
          title:'Energy Usage Dashboard',
          desc:'Data viz dashboard tracking energy consumption in hostels and labs.',
          mentor:{ name:'Dr. Helena Costa', email:'helena.costa@university.edu' },
          deadline: plus(20),
          team:['Isha Mehta','Tom Becker','Zara Ali','Omar Khan'],
          progress: 70,
          report:null
        }
      ];
    };

    // --- State & Persistence ---
    let assignments = makeAssignments();
    let projects = makeProjects();
    const LS_KEY = 'erp-demo-state-v1';

    const loadState = () => {
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return;
        const saved = JSON.parse(raw);
        // Merge saved into current samples by id
        for(const a of assignments){
          const sa = saved.assignments?.[a.id];
          if(sa){
            a.submitted = sa.submitted ?? a.submitted;
            if(sa.file){ a.file = { ...sa.file, at: new Date(sa.file.at) }; }
          }
        }
        for(const p of projects){
          const sp = saved.projects?.[p.id];
          if(sp){
            p.progress = sp.progress ?? p.progress;
            if(sp.report){ p.report = { ...sp.report, at: new Date(sp.report.at) }; }
          }
        }
      }catch(e){}
    };
    const saveState = () => {
      const payload = { assignments:{}, projects:{} };
      for(const a of assignments){
        payload.assignments[a.id] = { submitted:a.submitted, file:a.file || null };
      }
      for(const p of projects){
        payload.projects[p.id] = { progress:p.progress, report:p.report || null };
      }
      localStorage.setItem(LS_KEY, JSON.stringify(payload));
    };

    // --- Rendering Helpers ---
    const statusBadge = (a) => {
      const overdue = !a.submitted && daysUntil(a.due) < 0;
      if(a.submitted) return `<span class="badge badge-success">Submitted</span>`;
      if(overdue) return `<span class="badge badge-danger">Overdue</span>`;
      return `<span class="badge badge-warning">Pending</span>`;
    };

    const overdueRowCls = (a) => (!a.submitted && daysUntil(a.due) < 0) ? 'row-overdue' : '';

    const initials = (name) => (name.split(' ').map(n=>n[0]).join('').slice(0,2) || '?').toUpperCase();

    const projectStatus = (p) => {
      const left = daysUntil(p.deadline);
      const needs = (left <= 5 && p.progress < 70) || (left <= 2 && p.progress < 90);
      return needs
        ? `<span class="badge badge-warning">Needs Attention</span>`
        : `<span class="badge badge-success">On Track</span>`;
    };

    // --- DOM Targets ---
    const tableBody = $('#assignmentsTable');
    const cardsWrap = $('#assignmentsCards');
    const searchInput = $('#assignmentSearch');
    const projectsList = $('#projectsList');
    const projectsCount = $('#projectsCount');
    const timeline = $('#timeline');

    // --- Search State ---
    let searchTerm = '';

    // --- Assignment Upload Modal State ---
    let activeAssignmentId = null;
    let selectedAssignmentFile = null;

    // --- Project Upload Modal State ---
    let activeProjectId = null;
    let selectedProjectFile = null;

    // --- View Modal State ---
    let viewContext = null; // { type:'assignment'|'project', id }

    // --- Render Assignments ---
    const renderAssignments = () => {
      const q = searchTerm.trim().toLowerCase();
      const items = assignments.filter(a => {
        if(!q) return true;
        return a.subject.toLowerCase().includes(q) || a.title.toLowerCase().includes(q);
      });

      // Desktop table
      if(tableBody){
        tableBody.innerHTML = '';
        const container = document.createElement('tbody');
        items.forEach(a => {
          const tr = document.createElement('tr');
          tr.className = `${overdueRowCls(a)} border-b last:border-0`;
          tr.innerHTML = `
            <td class="px-4 py-3 whitespace-nowrap">${a.subject}</td>
            <td class="px-4 py-3">${a.title}</td>
            <td class="px-4 py-3 whitespace-nowrap">${fmt(a.due)}</td>
            <td class="px-4 py-3">${statusBadge(a)}</td>
            <td class="px-4 py-3 text-right">
              ${a.submitted
                ? `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-view-assignment="${a.id}">View</button>`
                : `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-upload-assignment="${a.id}">Upload</button>`
              }
            </td>
          `;
          container.appendChild(tr);
        });
        tableBody.replaceWith(container);
        container.id = 'assignmentsTable';
      }

      // Mobile cards
      if(cardsWrap){
        cardsWrap.innerHTML = '';
        items.forEach(a => {
          const card = document.createElement('div');
          card.className = `rounded-xl border ${overdueRowCls(a) ? 'border-red-100' : 'border-gray-100'} p-4 shadow-sm`;
          card.innerHTML = `
            <div class="flex items-start justify-between gap-3">
              <div>
                <p class="text-xs text-gray-500">${a.subject} • Due ${fmt(a.due)}</p>
                <p class="font-medium mt-1">${a.title}</p>
                <div class="mt-2">${statusBadge(a)}</div>
              </div>
              <div>
                ${a.submitted
                  ? `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-view-assignment="${a.id}">View</button>`
                  : `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-upload-assignment="${a.id}">Upload</button>`
                }
              </div>
            </div>
          `;
          cardsWrap.appendChild(card);
        });
      }
    };

    // --- Render Projects ---
    const renderProjects = () => {
      projectsCount.textContent = `${projects.length} total`;
      projectsList.innerHTML = '';
      projects.forEach(p => {
        const left = daysUntil(p.deadline);
        const card = document.createElement('div');
        card.className = 'lift rounded-20 border border-gray-100 shadow-soft p-5';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-3">
            <div>
              <h4 class="font-heading font-semibold">${p.title}</h4>
              <p class="text-sm text-[var(--text-secondary)] mt-1">${p.desc}</p>
            </div>
            <div class="shrink-0">${projectStatus(p)}</div>
          </div>

          <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="text-sm">
              <p class="text-gray-500">Mentor</p>
              <p class="font-medium">${p.mentor.name}</p>
              <a class="text-[var(--primary)] hover:underline text-xs" href="mailto:${p.mentor.email}">${p.mentor.email}</a>
            </div>
            <div class="text-sm">
              <p class="text-gray-500">Deadline</p>
              <p class="font-medium">${fmt(p.deadline)} <span class="text-xs text-gray-500">(${left >=0 ? left+' days left' : Math.abs(left)+' days ago'})</span></p>
            </div>
          </div>

          <div class="mt-4">
            <p class="text-sm text-gray-500 mb-1">Team</p>
            <div class="flex -space-x-2">
              ${p.team.map((n,i)=>{
                const hue = (n.charCodeAt(0)*13 + i*47) % 360;
                return `<div class="w-8 h-8 rounded-full border-2 border-white text-white text-xs flex items-center justify-center" style="background:hsl(${hue} 70% 50%);">${initials(n)}</div>`;
              }).join('')}
            </div>
          </div>

          <div class="mt-5">
            <div class="flex items-center justify-between mb-2 text-sm">
              <span class="text-gray-500">Progress</span>
              <span class="font-medium">${p.progress}%</span>
            </div>
            <div class="progress-track w-full h-3 rounded-full overflow-hidden">
              <div class="progress-fill h-full" style="width:${clamp(p.progress,0,100)}%"></div>
            </div>
            <div class="flex flex-wrap gap-3 mt-4">
              <button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-project-upload="${p.id}">${p.report ? 'Replace Report' : 'Upload Report'}</button>
              <button class="px-3 py-1.5 rounded-xl text-sm border border-gray-200 hover:bg-gray-50" data-progress-bump="${p.id}">+10% Progress</button>
              ${p.report ? `<button class="px-3 py-1.5 rounded-xl text-sm border border-gray-200 hover:bg-gray-50" data-project-view="${p.id}">View Report</button>` : ''}
            </div>
          </div>
        `;
        projectsList.appendChild(card);
      });

      // Mobile collapsible behavior (optional enhancement): keep cards simple and responsive by default
    };

    // --- Render Timeline ---
    const renderTimeline = () => {
      // Collect pending assignments and all projects by nearest deadlines
      const items = [];
      for(const a of assignments){
        if(!a.submitted){
          items.push({type:'Assignment', title:a.title, at:a.due, id:a.id});
        }
      }
      for(const p of projects){
        items.push({type:'Project', title:p.title, at:p.deadline, id:p.id});
      }
      items.sort((x,y)=> new Date(x.at) - new Date(y.at));

      const nowOrFuture = items.filter(it => daysUntil(it.at) >= -1).slice(0,6); // up to 6 closest
      timeline.innerHTML = '';

      if(nowOrFuture.length === 0){
        timeline.innerHTML = `<p class="text-sm text-gray-500">No upcoming deadlines. Nice work! 🎉</p>`;
        return;
      }

      const soonestId = nowOrFuture[0]?.id + nowOrFuture[0]?.type;

      const wrap = document.createElement('div');
      wrap.className = 'space-y-4';
      nowOrFuture.forEach(it => {
        const isSoonest = (it.id + it.type) === soonestId;
        const row = document.createElement('div');
        row.className = `rounded-xl border p-4 flex items-start gap-3 ${isSoonest ? 'highlight-next border-[var(--primary)]/30' : 'border-gray-100'}`;

        row.innerHTML = `
          <div class="mt-0.5 text-lg">${it.type === 'Assignment' ? '📝' : '📁'}</div>
          <div class="flex-1">
            <p class="text-sm text-gray-500">${it.type}</p>
            <p class="font-medium">${it.title}</p>
            <p class="text-xs text-gray-500 mt-1">Due ${fmt(it.at)} • ${daysUntil(it.at) >=0 ? daysUntil(it.at)+' day(s) left' : 'past due'}</p>
          </div>
          ${it.type === 'Assignment'
            ? `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-timeline-upload="${it.id}">Upload</button>`
            : `<button class="btn-gradient px-3 py-1.5 rounded-xl text-sm" data-timeline-project="${it.id}">Open</button>`
          }
        `;
        wrap.appendChild(row);
      });
      timeline.appendChild(wrap);
    };

    // --- Event Wiring ---
    const wireInteractions = () => {
      // Search
      searchInput.addEventListener('input', (e)=>{ searchTerm = e.target.value; renderAssignments(); });

      // Delegated clicks for assignment buttons (table + cards)
      document.body.addEventListener('click', (e)=>{
        const upBtn = e.target.closest('[data-upload-assignment]');
        const viewBtn = e.target.closest('[data-view-assignment]');
        const tlUpload = e.target.closest('[data-timeline-upload]');
        if(upBtn || tlUpload){
          const id = (upBtn?.dataset.uploadAssignment) || (tlUpload?.dataset.timelineUpload);
          openAssignmentModal(id);
        }
        if(viewBtn){
          const id = viewBtn.dataset.viewAssignment;
          openViewModal('assignment', id);
        }
      });

      // Projects: upload/view/bump
      document.body.addEventListener('click', (e)=>{
        const pUpload = e.target.closest('[data-project-upload]');
        const pView = e.target.closest('[data-project-view]');
        const pBump = e.target.closest('[data-progress-bump]');
        const tlProj = e.target.closest('[data-timeline-project]');
        if(pUpload){
          openProjectModal(pUpload.dataset.projectUpload);
        }
        if(pView){
          openViewModal('project', pView.dataset.projectView);
        }
        if(pBump){
          const id = pBump.dataset.progressBump;
          const p = projects.find(x=>x.id===id);
          if(p){ p.progress = clamp(p.progress + 10, 0, 100); saveState(); renderProjects(); renderTimeline(); }
        }
        if(tlProj){
          // For demo, just scroll projects into view
          document.querySelector('aside').scrollIntoView({ behavior:'smooth', block:'start' });
        }
      });

      // Notifications and Profile menus
      const btnNotifs = $('#btnNotifs');
      const notifMenu = $('#notifMenu');
      const btnProfile = $('#btnProfile');
      const profileMenu = $('#profileMenu');
      const notifDot = $('#notifDot');

      btnNotifs.addEventListener('click', ()=>{
        notifMenu.classList.toggle('hidden');
        profileMenu.classList.add('hidden');
        notifDot.classList.add('hidden');
      });
      btnProfile.addEventListener('click', ()=>{
        profileMenu.classList.toggle('hidden');
        notifMenu.classList.add('hidden');
      });
      document.addEventListener('click', (e)=>{
        if(!e.target.closest('#btnNotifs') && !e.target.closest('#notifMenu')) notifMenu.classList.add('hidden');
        if(!e.target.closest('#btnProfile') && !e.target.closest('#profileMenu')) profileMenu.classList.add('hidden');
      });

      // Demo "new notification" dot after 3s
      setTimeout(()=>{ notifDot.classList.remove('hidden'); }, 3000);

      // Upcoming refresh
      $('#refreshTimeline').addEventListener('click', ()=> renderTimeline() );
    };

    // --- Modals: Assignment Upload ---
    const openAssignmentModal = (id) => {
      activeAssignmentId = id;
      selectedAssignmentFile = null;
      $('#assignmentFileInput').value = '';
      $('#assignmentFileName').textContent = '';
      $('#confirmAssignmentUpload').disabled = true;

      const a = assignments.find(x=>x.id===id);
      $('#modalAssignmentTitle').textContent = `${a.subject} — ${a.title}`;
      $('#assignmentModal').classList.remove('hidden');
    };
    const closeAssignmentModal = () => {
      $('#assignmentModal').classList.add('hidden');
      activeAssignmentId = null;
      selectedAssignmentFile = null;
    };
    $$('[data-close-assignment-modal]').forEach(b=> b.addEventListener('click', closeAssignmentModal));
    $('#assignmentFileInput').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      selectedAssignmentFile = file || null;
      $('#assignmentFileName').textContent = file ? file.name : '';
      $('#confirmAssignmentUpload').disabled = !file;
    });
    $('#confirmAssignmentUpload').addEventListener('click', ()=>{
      if(!activeAssignmentId || !selectedAssignmentFile) return;
      const a = assignments.find(x=>x.id===activeAssignmentId);
      a.submitted = true;
      a.file = { name:selectedAssignmentFile.name, at:new Date() };
      saveState();
      renderAssignments();
      renderTimeline();
      closeAssignmentModal();
    });

    // --- Modals: Project Upload ---
    const openProjectModal = (id) => {
      activeProjectId = id;
      selectedProjectFile = null;
      $('#projectFileInput').value = '';
      $('#projectFileName').textContent = '';
      $('#confirmProjectUpload').disabled = true;

      const p = projects.find(x=>x.id===id);
      $('#modalProjectTitle').textContent = p.title;
      $('#projectModal').classList.remove('hidden');
    };
    const closeProjectModal = () => {
      $('#projectModal').classList.add('hidden');
      activeProjectId = null;
      selectedProjectFile = null;
    };
    $$('[data-close-project-modal]').forEach(b=> b.addEventListener('click', closeProjectModal));
    $('#projectFileInput').addEventListener('change', (e)=>{
      const file = e.target.files?.[0];
      selectedProjectFile = file || null;
      $('#projectFileName').textContent = file ? file.name : '';
      $('#confirmProjectUpload').disabled = !file;
    });
    $('#confirmProjectUpload').addEventListener('click', ()=>{
      if(!activeProjectId || !selectedProjectFile) return;
      const p = projects.find(x=>x.id===activeProjectId);
      p.report = { name:selectedProjectFile.name, at:new Date() };
      saveState();
      renderProjects();
      renderTimeline();
      closeProjectModal();
    });

    // --- View Modal (assignment/project) ---
    const openViewModal = (type, id) => {
      viewContext = { type, id };
      let title='', file=null, ts=null;
      if(type==='assignment'){
        const a = assignments.find(x=>x.id===id); if(!a || !a.file) return;
        title = `${a.subject} — ${a.title}`;
        file = a.file.name;
        ts = a.file.at;
      }else{
        const p = projects.find(x=>x.id===id); if(!p || !p.report) return;
        title = p.title;
        file = p.report.name;
        ts = p.report.at;
      }
      $('#viewItemTitle').textContent = title;
      $('#viewFileName').textContent = file;
      $('#viewTimestamp').textContent = `Uploaded on ${fmt(ts)} at ${new Date(ts).toLocaleTimeString()}`;
      $('#viewModal').classList.remove('hidden');
    };
    const closeViewModal = () => {
      $('#viewModal').classList.add('hidden');
      viewContext = null;
    };
    $$('[data-close-view-modal]').forEach(b=> b.addEventListener('click', closeViewModal));

    // Replace file from view modal
    $('#replaceUpload').addEventListener('click', ()=>{
      if(!viewContext) return;
      if(viewContext.type==='assignment'){
        closeViewModal();
        openAssignmentModal(viewContext.id);
      }else{
        closeViewModal();
        openProjectModal(viewContext.id);
      }
    });

    // Remove upload
    $('#removeUpload').addEventListener('click', ()=>{
      if(!viewContext) return;
      if(viewContext.type==='assignment'){
        const a = assignments.find(x=>x.id===viewContext.id);
        if(a){ a.submitted = false; a.file = null; }
      }else{
        const p = projects.find(x=>x.id===viewContext.id);
        if(p){ p.report = null; }
      }
      saveState();
      renderAssignments();
      renderProjects();
      renderTimeline();
      closeViewModal();
    });

    // Close modals on overlay click
    document.addEventListener('click', (e)=>{
      if(e.target.closest('#assignmentModal > .absolute.inset-0.bg-black\\/30')) closeAssignmentModal();
      if(e.target.closest('#projectModal > .absolute.inset-0.bg-black\\/30')) closeProjectModal();
      if(e.target.closest('#viewModal > .absolute.inset-0.bg-black\\/30')) closeViewModal();
    });

    // --- Init ---
    loadState();
    renderAssignments();
    renderProjects();
    renderTimeline();
    wireInteractions();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9822483224d75857',t:'MTc1ODM4MTM2Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
