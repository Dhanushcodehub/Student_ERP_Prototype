<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student ERP — Announcements & Notices</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    /* Font helpers */
    .font-poppins { font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Cantarell, 'Helvetica Neue', 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', Arial, sans-serif; }
    .font-roboto { font-family: 'Roboto', system-ui, -apple-system, Segoe UI, Cantarell, 'Helvetica Neue', 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', Arial, sans-serif; }
    /* Truncate to 2 lines */
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    /* Smooth scrolling inside lists */
    .nice-scroll::-webkit-scrollbar { width: 10px; }
    .nice-scroll::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.12); border-radius: 9999px; }
    .nice-scroll::-webkit-scrollbar-track { background: transparent; }
    .heading{
        font-size: 25px !important;
    }
  </style>
</head>
<body class="bg-white font-roboto text-[#555]">
  <!-- Top Navigation -->
  <header class="fixed top-0 inset-x-0 z-50 bg-white/95 backdrop-blur supports-[backdrop-filter]:bg-white/80 border-b border-slate-100 shadow-sm">
    <div class="max-w-6xl mx-auto px-4 md:px-6">
      <div class="h-16 flex items-center justify-between">
        <!-- Left: Logo -->
        <a href="#" class="flex items-center gap-3 group" onclick="event.preventDefault()">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-gradient-to-br from-[#e6f2ff] to-[#4da6ff]/20 ring-1 ring-[#4da6ff]/20">
            <!-- Simple logo -->
            <svg width="20" height="20" viewBox="0 0 24 24" class="text-[#4da6ff]">
              <path d="M3 11l9-7v16l-9-7zM14 7h7v10h-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <div class="leading-tight">
            <div class="font-poppins font-semibold text-slate-900">Student ERP</div>
            <div class="text-xs text-slate-500 -mt-0.5">Campus Portal</div>
          </div>
        </a>

        <!-- Middle: Page Title -->
        <h1 class="hidden sm:block font-poppins font-semibold text-slate-900 tracking-tight heading">
          Announcements & Notices
        </h1>

        <!-- Right: Actions -->
        <div class="flex items-center gap-2">
          <!-- Notifications -->
          <div class="relative">
            <button id="btnBell" class="relative inline-flex items-center justify-center h-10 w-10 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors"
              aria-label="Notifications" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M15 17h5l-1.4-1.4A2 2 0 0 1 18 14.2V11a6 6 0 0 0-12 0v3.2c0 .5-.2 1-.6 1.4L4 17h5m6 0a3 3 0 0 1-6 0" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <span id="bellDot" class="hidden absolute -top-1 -right-1 h-2.5 w-2.5 bg-[#4da6ff] rounded-full ring-2 ring-white"></span>
            </button>
            <!-- Bell popover -->
            <div id="bellMenu" class="hidden absolute right-0 mt-2 w-80 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 p-3">
              <div class="flex items-center justify-between px-1 pb-2">
                <div class="font-poppins font-semibold text-slate-900">Recent</div>
                <button id="markAllRead" class="text-xs text-[#4da6ff] hover:underline">Mark all read</button>
              </div>
              <div id="bellList" class="space-y-2 max-h-64 overflow-auto nice-scroll pr-1"></div>
              <div class="pt-2 text-center">
                <a href="#latest" class="text-xs text-slate-500 hover:text-slate-700" onclick="closeAllMenus()">View all announcements</a>
              </div>
            </div>
          </div>

          <!-- Profile -->
          <div class="relative">
            <button id="btnProfile" class="inline-flex items-center justify-center h-10 px-3 rounded-xl border border-slate-200 hover:border-[#4da6ff]/40 hover:bg-[#e6f2ff] transition-colors gap-2" type="button">
              <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-700">
                <path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 3c-4.418 0-8 2.239-8 5v1h16v-1c0-2.761-3.582-5-8-5Z" fill="currentColor"/>
              </svg>
              <span class="hidden sm:inline text-sm text-slate-800">Profile</span>
            </button>
            <!-- Profile dropdown -->
            <div id="profileMenu" class="hidden absolute right-0 mt-2 w-52 bg-white rounded-2xl shadow-xl ring-1 ring-slate-100 overflow-hidden">
              <div class="px-4 py-3">
                <div class="font-poppins font-semibold text-slate-900">John Doe</div>
                <div class="text-xs text-slate-500">Student • CS Dept</div>
              </div>
              <div class="border-t border-slate-100"></div>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">View Profile</button>
              <button class="w-full text-left px-4 py-2.5 text-sm hover:bg-[#e6f2ff]" onclick="alert('Demo only')">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="pt-20 max-w-6xl mx-auto px-4 md:px-6 space-y-6 md:space-y-8 pb-12">
    <!-- Latest Announcements -->
    <section id="latest" class="bg-white rounded-[20px] shadow-[0_8px_30px_rgba(0,0,0,0.06)] ring-1 ring-slate-100">
      <div class="flex items-center justify-between px-5 md:px-7 py-4 md:py-5 border-b border-slate-100">
        <div class="flex items-center gap-3">
          <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-[#e6f2ff] text-[#4da6ff]">
            <svg viewBox="0 0 24 24" class="h-5 w-5">
              <path d="M3 11l9-7v16l-9-7zM14 7h7v10h-7" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <h2 class="font-poppins font-semibold text-slate-900">Latest Announcements</h2>
        </div>
        <div class="flex items-center gap-2">
          <div class="hidden sm:flex items-center gap-1 text-xs text-slate-500">
            <span class="inline-block h-2 w-2 rounded-full bg-[#4da6ff]"></span> Normal
            <span class="inline-block h-2 w-2 rounded-full bg-orange-400 ml-3"></span> Important
            <span class="inline-block h-2 w-2 rounded-full bg-red-500 ml-3"></span> Urgent
          </div>
        </div>
      </div>

      <div class="p-4 md:p-6">
        <!-- Announcements list -->
        <div class="max-h-[26rem] overflow-y-auto nice-scroll pr-1" id="announcementsList" aria-live="polite">
          <!-- JS will render items here -->
        </div>
      </div>
    </section>

    <!-- Notification Preferences -->
    <section class="bg-white rounded-[20px] shadow-[0_8px_30px_rgba(0,0,0,0.06)] ring-1 ring-slate-100">
      <div class="flex items-center gap-3 px-5 md:px-7 py-4 md:py-5 border-b border-slate-100">
        <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-[#e6f2ff] text-[#4da6ff]">
          <svg viewBox="0 0 24 24" class="h-5 w-5">
            <path d="M12 6v6l4 2" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="9" fill="none" stroke="currentColor" stroke-width="1.8"/>
          </svg>
        </span>
        <h2 class="font-poppins font-semibold text-slate-900">Notification Preferences</h2>
      </div>

      <form id="prefsForm" class="px-5 md:px-7 py-5 space-y-5" autocomplete="off">
        <!-- Toggles -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Push -->
          <div class="flex items-center justify-between p-4 rounded-2xl ring-1 ring-slate-100 hover:ring-[#4da6ff]/40 transition">
            <div>
              <div class="font-medium text-slate-800">Push Notifications</div>
              <div class="text-xs text-slate-500">Pop-up alerts on new announcements</div>
            </div>
            <button type="button" id="togglePush" role="switch" aria-checked="true" class="relative h-7 w-12 rounded-full transition-colors border border-slate-200 bg-[#e6f2ff] outline-none focus-visible:ring-2 focus-visible:ring-[#4da6ff]">
              <span class="absolute top-0.5 left-0.5 h-6 w-6 bg-white rounded-full shadow transition-transform translate-x-0"></span>
            </button>
          </div>
          <!-- Email -->
          <div class="flex items-center justify-between p-4 rounded-2xl ring-1 ring-slate-100 hover:ring-[#4da6ff]/40 transition">
            <div>
              <div class="font-medium text-slate-800">Email Notifications</div>
              <div class="text-xs text-slate-500">Get emails for new and urgent notices</div>
            </div>
            <button type="button" id="toggleEmail" role="switch" aria-checked="true" class="relative h-7 w-12 rounded-full transition-colors border border-slate-200 bg-[#e6f2ff] outline-none focus-visible:ring-2 focus-visible:ring-[#4da6ff]">
              <span class="absolute top-0.5 left-0.5 h-6 w-6 bg-white rounded-full shadow transition-transform translate-x-0"></span>
            </button>
          </div>
        </div>

        <!-- Frequency -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <label class="block">
            <span class="block text-sm font-medium text-slate-700 mb-2">Frequency</span>
            <div class="relative">
              <select id="frequency" class="w-full appearance-none rounded-xl border border-slate-200 bg-white px-4 py-2.5 pr-10 text-sm focus:outline-none focus:ring-2 focus:ring-[#4da6ff]">
                <option value="immediate">Immediate</option>
                <option value="daily">Daily</option>
                <option value="weekly">Weekly</option>
              </select>
              <svg viewBox="0 0 24 24" class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500">
                <path d="M6 9l6 6 6-6" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </label>
          <div class="text-xs text-slate-500 md:self-end">
            Note: This is a demo. Preferences are saved locally in your browser. Real push/email delivery isn’t supported here.
          </div>
        </div>

        <div class="flex items-center justify-between pt-2">
          <div class="text-xs text-slate-500">Status colors: Blue (Normal), Orange (Important), Red (Urgent)</div>
          <button id="savePrefs" type="submit" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-[#4da6ff] to-[#6db8ff] text-white font-medium px-5 py-2.5 shadow hover:shadow-md transition active:scale-[0.98]">
            <svg viewBox="0 0 24 24" class="h-4 w-4">
              <path d="M5 13l4 4L19 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Save Settings
          </button>
        </div>
      </form>
    </section>
  </main>

  <!-- Details Modal -->
  <div id="detailsModal" class="hidden fixed inset-0 z-[60]">
    <div class="absolute inset-0 bg-slate-900/50"></div>
    <div class="relative h-full w-full flex items-end sm:items-center justify-center p-4">
      <div class="w-full sm:max-w-2xl bg-white rounded-[20px] shadow-2xl ring-1 ring-slate-100 overflow-hidden">
        <div class="flex items-start justify-between p-5 border-b border-slate-100">
          <div class="flex items-center gap-2">
            <span id="modalBadge" class="px-3 py-1 rounded-full text-xs font-medium"></span>
            <h3 id="modalTitle" class="font-poppins font-semibold text-slate-900"></h3>
          </div>
          <button class="h-9 w-9 rounded-xl hover:bg-slate-100 flex items-center justify-center" onclick="closeModal()" aria-label="Close">
            <svg viewBox="0 0 24 24" class="h-5 w-5 text-slate-600">
              <path d="M18 6 6 18M6 6l12 12" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </button>
        </div>
        <div class="p-5 space-y-4">
          <div class="text-sm text-slate-500" id="modalDate"></div>
          <p id="modalDesc" class="text-slate-700 leading-relaxed"></p>
        </div>
        <div class="px-5 pb-5 flex items-center justify-between">
          <div class="text-xs text-slate-500">This item is now marked as read.</div>
          <button class="rounded-full px-4 py-2 text-slate-700 hover:bg-slate-100" onclick="closeModal()">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="hidden fixed bottom-5 right-5 z-[70]">
    <div class="rounded-2xl bg-slate-900 text-white px-4 py-3 text-sm shadow-lg flex items-center gap-2">
      <svg viewBox="0 0 24 24" class="h-4 w-4 text-[#4da6ff]">
        <path d="M5 13l4 4L19 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <span id="toastMsg">Saved</span>
    </div>
  </div>

  <script>
    // Sample announcements data (small set)
    const announcements = [
      {
        id: 'a6', title: 'Urgent: Campus Network Maintenance',
        date: '2025-09-22 08:30',
        desc: 'There will be a scheduled maintenance window tonight from 11:00 PM to 2:00 AM. Internet access and ERP services may be temporarily unavailable. Please save your work in advance.',
        priority: 'urgent'
      },
      {
        id: 'a5', title: 'Important: Mid-Sem Timetable Release',
        date: '2025-09-20 17:10',
        desc: 'Mid-semester examination timetable is now available. Review your slots and inform the department of any clashes before Friday 5 PM.',
        priority: 'important'
      },
      {
        id: 'a4', title: 'Workshop: Resume & Portfolio Clinic',
        date: '2025-09-19 10:00',
        desc: 'Career Cell is hosting a hands-on clinic on building standout resumes and portfolios. Limited seats. Register by Wednesday.',
        priority: 'normal'
      },
      {
        id: 'a3', title: 'Important: Library Due Date Extended',
        date: '2025-09-18 09:00',
        desc: 'All book return deadlines have been extended by 3 days due to system updates. Late fines will be waived during this period.',
        priority: 'important'
      },
      {
        id: 'a2', title: 'Cultural Fest: Volunteers Needed',
        date: '2025-09-16 15:30',
        desc: 'Join the organizing team for the annual fest! Roles available across logistics, design, outreach, and stage management.',
        priority: 'normal'
      },
      {
        id: 'a1', title: 'Urgent: Heavy Rain Advisory',
        date: '2025-09-15 07:15',
        desc: 'Classes before noon are shifted online due to severe weather. Stay indoors and follow official updates for any changes.',
        priority: 'urgent'
      },
    ];

    // Track read items in localStorage
    const READ_KEY = 'erp_read_ann';
    const PREFS_KEY = 'erp_prefs';

    let readSet = new Set(JSON.parse(localStorage.getItem(READ_KEY) || '[]'));

    function saveRead() {
      localStorage.setItem(READ_KEY, JSON.stringify(Array.from(readSet)));
    }

    function formatDate(dtStr) {
      const d = new Date(dtStr.replace(' ', 'T'));
      const opts = { weekday: 'short', year: 'numeric', month: 'short', day: 'numeric',
                     hour: '2-digit', minute: '2-digit' };
      return d.toLocaleString(undefined, opts);
    }

    function badgeClasses(priority) {
      if (priority === 'urgent') return { pill: 'bg-red-50 text-red-600', left: 'border-l-4 border-red-500', dot: 'bg-red-500' };
      if (priority === 'important') return { pill: 'bg-orange-50 text-orange-600', left: 'border-l-4 border-orange-400', dot: 'bg-orange-400' };
      return { pill: 'bg-[#e6f2ff] text-[#4da6ff]', left: 'border-l-4 border-[#4da6ff]', dot: 'bg-[#4da6ff]' };
    }

    function renderAnnouncements() {
      const list = document.getElementById('announcementsList');
      list.innerHTML = '';

      const sorted = [...announcements].sort((a, b) => new Date(b.date) - new Date(a.date));
      for (const item of sorted) {
        const read = readSet.has(item.id);
        const c = badgeClasses(item.priority);

        const card = document.createElement('article');
        card.className =
          `group relative mb-3 last:mb-0 rounded-2xl ring-1 ring-slate-100 ${c.left} bg-white p-4 transition 
           hover:shadow-[0_12px_28px_rgba(0,0,0,0.08)] hover:-translate-y-0.5`;

        card.innerHTML = `
          <div class="flex items-start gap-4">
            <div class="mt-1">
              <span class="inline-block h-3.5 w-3.5 rounded-full ${c.dot} opacity-90"></span>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <h3 class="font-poppins font-semibold text-slate-900">${item.title}</h3>
                <span class="px-3 py-1 rounded-full text-xs font-medium ${c.pill}">
                  ${item.priority === 'urgent' ? 'Urgent' : item.priority === 'important' ? 'Important' : 'Normal'}
                </span>
                ${!read ? '<span class="text-[10px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-600">New</span>' : ''}
              </div>
              <div class="text-xs text-slate-500 mt-1">${formatDate(item.date)}</div>
              <p class="mt-2 text-sm text-slate-700 line-clamp-2">${item.desc}</p>

              <div class="mt-3 flex items-center gap-3">
                <button data-id="${item.id}" class="btn-view inline-flex items-center gap-2 rounded-full border border-[#4da6ff] text-[#4da6ff] px-3 py-1.5 text-sm transition hover:bg-[#e6f2ff]">
                  <svg viewBox="0 0 24 24" class="h-4 w-4">
                    <path d="M12 5v14M5 12h14" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  View Details
                </button>
                ${!read ? `<button data-id="${item.id}" class="btn-mark inline-flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs bg-slate-100 text-slate-700 hover:bg-slate-200 transition">Mark read</button>` : ''}
              </div>
            </div>
          </div>
          ${!read ? '<span class="absolute top-3 right-3 h-2.5 w-2.5 rounded-full bg-[#4da6ff]"></span>' : ''}
        `;

        list.appendChild(card);
      }

      // Bind actions
      list.querySelectorAll('.btn-view').forEach(btn => {
        btn.addEventListener('click', (e) => openDetails(e.currentTarget.getAttribute('data-id')));
      });
      list.querySelectorAll('.btn-mark').forEach(btn => {
        btn.addEventListener('click', (e) => markRead(e.currentTarget.getAttribute('data-id')));
      });

      updateBell();
      renderBellMenu();
    }

    function markRead(id) {
      readSet.add(id);
      saveRead();
      renderAnnouncements();
    }

    // Details modal
    function openDetails(id) {
      const item = announcements.find(a => a.id === id);
      if (!item) return;

      // Mark as read once opened
      if (!readSet.has(id)) {
        readSet.add(id);
        saveRead();
      }

      const badge = document.getElementById('modalBadge');
      const title = document.getElementById('modalTitle');
      const date = document.getElementById('modalDate');
      const desc = document.getElementById('modalDesc');

      const c = badgeClasses(item.priority);
      badge.className = `px-3 py-1 rounded-full text-xs font-medium ${c.pill}`;
      badge.textContent = item.priority === 'urgent' ? 'Urgent' : item.priority === 'important' ? 'Important' : 'Normal';

      title.textContent = item.title;
      date.textContent = formatDate(item.date);
      desc.textContent = item.desc;

      document.getElementById('detailsModal').classList.remove('hidden');
      renderAnnouncements(); // refresh list/read state
    }
    function closeModal() {
      document.getElementById('detailsModal').classList.add('hidden');
    }

    // Bell indicator and menu
    function unreadCount() {
      return announcements.reduce((acc, a) => acc + (readSet.has(a.id) ? 0 : 1), 0);
    }
    function updateBell() {
      const dot = document.getElementById('bellDot');
      if (unreadCount() > 0) dot.classList.remove('hidden'); else dot.classList.add('hidden');
    }
    function renderBellMenu() {
      const cont = document.getElementById('bellList');
      cont.innerHTML = '';
      const latest = [...announcements].sort((a,b) => new Date(b.date)-new Date(a.date)).slice(0,4);
      latest.forEach(a => {
        const read = readSet.has(a.id);
        const c = badgeClasses(a.priority);
        const row = document.createElement('button');
        row.type = 'button';
        row.className = `w-full text-left px-3 py-2 rounded-xl border border-slate-100 hover:bg-slate-50 transition flex items-start gap-3`;
        row.innerHTML = `
          <span class="mt-1 inline-block h-2.5 w-2.5 rounded-full ${c.dot} ${read ? 'opacity-40' : ''}"></span>
          <div class="min-w-0">
            <div class="flex items-center gap-2">
              <span class="text-sm font-medium text-slate-800 truncate">${a.title}</span>
              <span class="px-2 py-0.5 rounded-full text-[10px] ${c.pill}">
                ${a.priority === 'urgent' ? 'Urgent' : a.priority === 'important' ? 'Important' : 'Normal'}
              </span>
            </div>
            <div class="text-[11px] text-slate-500">${formatDate(a.date)}</div>
          </div>
        `;
        row.addEventListener('click', () => {
          closeAllMenus();
          openDetails(a.id);
        });
        cont.appendChild(row);
      });
    }

    function closeAllMenus() {
      document.getElementById('bellMenu').classList.add('hidden');
      document.getElementById('profileMenu').classList.add('hidden');
    }

    document.getElementById('btnBell').addEventListener('click', (e) => {
      e.stopPropagation();
      const menu = document.getElementById('bellMenu');
      const other = document.getElementById('profileMenu');
      other.classList.add('hidden');
      menu.classList.toggle('hidden');
    });

    document.getElementById('btnProfile').addEventListener('click', (e) => {
      e.stopPropagation();
      const menu = document.getElementById('profileMenu');
      const other = document.getElementById('bellMenu');
      other.classList.add('hidden');
      menu.classList.toggle('hidden');
    });

    document.getElementById('markAllRead').addEventListener('click', () => {
      announcements.forEach(a => readSet.add(a.id));
      saveRead();
      renderAnnouncements();
      renderBellMenu();
    });

    window.addEventListener('click', closeAllMenus);

    // Toggles
    function setToggle(el, on) {
      el.setAttribute('aria-checked', on ? 'true' : 'false');
      if (on) {
        el.classList.add('bg-[#4da6ff]');
        el.classList.remove('bg-[#e6f2ff]');
        el.querySelector('span').style.transform = 'translateX(20px)';
      } else {
        el.classList.remove('bg-[#4da6ff]');
        el.classList.add('bg-[#e6f2ff]');
        el.querySelector('span').style.transform = 'translateX(0px)';
      }
    }

    const togglePush = document.getElementById('togglePush');
    const toggleEmail = document.getElementById('toggleEmail');

    togglePush.addEventListener('click', () => setToggle(togglePush, togglePush.getAttribute('aria-checked') !== 'true'));
    toggleEmail.addEventListener('click', () => setToggle(toggleEmail, toggleEmail.getAttribute('aria-checked') !== 'true'));

    // Preferences: save & load
    function loadPrefs() {
      try {
        const p = JSON.parse(localStorage.getItem(PREFS_KEY) || '{}');
        const push = p.push ?? true;
        const email = p.email ?? true;
        const freq = p.frequency ?? 'immediate';
        setToggle(togglePush, push);
        setToggle(toggleEmail, email);
        document.getElementById('frequency').value = freq;
      } catch {
        setToggle(togglePush, true);
        setToggle(toggleEmail, true);
        document.getElementById('frequency').value = 'immediate';
      }
    }

    function showToast(msg = 'Saved') {
      const toast = document.getElementById('toast');
      document.getElementById('toastMsg').textContent = msg;
      toast.classList.remove('hidden');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.add('hidden'), 1800);
    }

    document.getElementById('prefsForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const prefs = {
        push: togglePush.getAttribute('aria-checked') === 'true',
        email: toggleEmail.getAttribute('aria-checked') === 'true',
        frequency: document.getElementById('frequency').value
      };
      localStorage.setItem(PREFS_KEY, JSON.stringify(prefs));
      showToast('Preferences saved');
    });

    // Init
    loadPrefs();
    renderAnnouncements();
  </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98226639135531cf',t:'MTc1ODM4MjU5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
